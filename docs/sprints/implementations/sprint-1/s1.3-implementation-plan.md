# S1.3 Implementation Plan: Frontend-Backend API Integration

## Story Overview

**Story ID**: S1.3  
**Title**: Frontend-Backend API Integration  
**Dependencies**: S1.1 (PHP Backend API Foundation), S1.2 (Database Schema Design and Connection)

## Goal

Integrate the React frontend with the PHP backend API to enable data flow between frontend and backend, establishing the foundation for future content features.

## Acceptance Criteria Mapping

1. ✅ **Frontend API service layer** with proper TypeScript types
2. ✅ **Error handling** for network failures and API errors  
3. ✅ **Loading states** for API operations
4. ✅ **Environment configuration** for local vs production APIs
5. ✅ **CORS validation** with actual API calls
6. ✅ **Basic release data endpoints** (GET operations) 
7. ✅ **Frontend confirmation** of backend connectivity
8. ✅ **API timeout and retry logic**

## Technical Approach

### Technology Stack Integration
- **Frontend**: React 19.0.0 + TypeScript 5.7.2 + Material-UI 7.0.2
- **HTTP Client**: axios 1.7.7 (exact version)
- **Backend**: PHP API endpoints (S1.1 implementation)
- **CORS**: Pre-configured in backend security.php

### Design Patterns Applied

#### 1. Service Layer Pattern
```typescript
// Centralized API service
class ApiService {
  private readonly client: AxiosInstance;
  constructor(config: ApiConfig) { /* ... */ }
  
  releases = {
    getAll: () => Promise<Release[]>,
    getById: (id: number) => Promise<Release>
  }
}
```

#### 2. Factory Pattern  
```typescript
// API service factory for environment switching
export const createApiService = (environment: 'development' | 'production') => {
  return new ApiService(getApiConfig(environment));
}
```

#### 3. Error Handling Pattern
```typescript
// Consistent error boundary approach
interface ApiError {
  message: string;
  code?: number;
  details?: unknown;
}
```

#### 4. Environment Configuration Pattern
```typescript
// Runtime environment switching
const config = {
  development: { baseURL: 'http://localhost:8000/api' },
  production: { baseURL: 'https://alldayeverydayrecords.com/api' }
}
```

## Implementation Increments

### Increment 1: Dependencies and Environment Setup
**Purpose**: Setup axios dependency and environment configuration  
**Acceptance Criteria**: Environment configuration switches between local and production APIs  
**Files Modified**: 
- `package.json` (add axios 1.7.7)
- `src/config/api.ts` (environment configuration)

**Implementation Details**:
- Add axios 1.7.7 to dependencies
- Create environment-based API configuration
- Setup development (localhost:8000) and production URL switching

### Increment 2: TypeScript Types and Interfaces  
**Purpose**: Define strong type safety for all API interactions  
**Acceptance Criteria**: Frontend API service layer with proper TypeScript types  
**Files Created**:
- `src/types/Release.ts`
- `src/types/Artist.ts`  
- `src/types/ApiResponse.ts`
- `src/types/ApiError.ts`

**Implementation Details**:
- Define Release, Artist, Label, StreamingLink interfaces
- Create generic ApiResponse<T> wrapper type
- Define comprehensive error handling types
- Export all types from src/types/index.ts

### Increment 3: Core API Service Layer
**Purpose**: Create axios instance with interceptors, timeout, and retry logic  
**Acceptance Criteria**: API timeout and retry logic implemented, Error handling for network failures  
**Files Created**:
- `src/services/apiService.ts`
- `src/services/apiConfig.ts`

**Implementation Details**:
- Create axios instance with environment-based configuration  
- Implement request/response interceptors for logging and error handling
- Add automatic retry logic for network failures
- Configure timeout settings (5s connection, 10s request)

### Increment 4: Release API Service
**Purpose**: Implement specific release data endpoints  
**Acceptance Criteria**: Basic release data endpoints functional (GET operations)  
**Files Created**:
- `src/services/releaseService.ts`
- Update `src/services/index.ts`

**Implementation Details**:
- Implement getReleases() method mapping to get-releases.php
- Implement getReleaseById(id) method mapping to get-releases-by-id.php  
- Add proper error handling and response transformation
- Ensure type safety with TypeScript interfaces

### Increment 5: Integration Testing Component
**Purpose**: Test CORS integration and validate all acceptance criteria  
**Acceptance Criteria**: CORS validation, Frontend confirmation of backend connectivity, Loading states  
**Files Created**:
- `src/pages/ApiTest.tsx`  
- `src/components/ConnectivityStatus.tsx`
- Update routing in `src/App.tsx`

**Implementation Details**:
- Create API testing page with release data display
- Add connectivity status component showing backend health
- Implement loading states and error boundaries  
- Test all API endpoints with actual backend calls
- Validate CORS configuration works with localhost:5173

## Architectural Directives

### Pattern Compliance Validation

#### ✅ Service Layer Pattern
- All API communication centralized in service layer
- No direct axios usage in components
- Clean separation of concerns between UI and data access

#### ✅ Factory Pattern
- Environment-based API service creation
- Configurable service instances
- No hardcoded environment dependencies in components

#### ✅ Type Safety Pattern  
- All API responses strongly typed
- No 'any' types in API service layer
- Comprehensive error type definitions

#### ✅ Error Handling Pattern
- Consistent error response structure
- Network failure recovery
- User-friendly error messages

### Security Considerations
- CORS validation with actual cross-origin requests
- Input sanitization on API service layer
- Environment-based URL configuration (no hardcoded production URLs)

### Performance Considerations  
- Request timeout configuration
- Automatic retry for failed requests
- Efficient error boundary implementation

## Integration Points

### Backend Integration
- **Endpoint Mapping**:
  - `GET /get-releases.php` → `releaseService.getAll()`
  - `GET /get-releases-by-id.php?id=X` → `releaseService.getById(X)`
  - `GET /health.php` → `apiService.healthCheck()`

### Frontend Integration
- **Component Usage**: API service available via dependency injection pattern
- **Error Boundaries**: Graceful fallback for API failures  
- **Loading States**: Material-UI loading indicators during API calls

## Success Criteria

### Technical Validation
- ✅ All API endpoints return expected data structure
- ✅ CORS requests successful from localhost:5173 to backend  
- ✅ Error handling displays appropriate messages
- ✅ Loading states show during API operations
- ✅ TypeScript compilation without errors
- ✅ Environment switching works correctly

### User Experience Validation  
- ✅ Backend connectivity clearly displayed
- ✅ Smooth loading transitions
- ✅ Error recovery doesn't break application
- ✅ API data displays correctly in UI

## Next Sprint Enablers

This implementation provides:
- **Data Layer Foundation**: Complete API service layer for Sprint 2 content features
- **Error Handling**: Robust error management for user-facing features  
- **Environment Support**: Seamless dev/production API switching
- **Type Safety**: Strong TypeScript foundation for release management features
- **CORS Validation**: Proven cross-origin communication for hybrid development

Sprint 2 content features can immediately leverage this API integration for release display, admin features, and content management functionality.