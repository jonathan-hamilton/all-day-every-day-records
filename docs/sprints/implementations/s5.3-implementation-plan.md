# S5.3 Implementation Plan: Admin Videos Management Interface

**Story**: S5.3 - Admin Videos Management Interface  
**Sprint**: 5  
**Priority**: HIGH  
**Estimate**: 8-10 hours  
**Status**: IN PROGRESS  
**Date**: December 13, 2025

## Story Summary

Add video management functionality to the Admin Dashboard using a tabbed interface. Admin users can create, edit, and delete videos through a form that mirrors the existing Release management interface. Videos are displayed alphabetically by Artist, then Title.

## Clarifications from User

1. **Tab Navigation**: AdminDashboard will have Tabs at the top with "Manage Releases" and "Manage Videos" labels
2. **Form Layout**: Video upsert form mirrors Release form structure with submit button at bottom
3. **Tab Switching**: Selecting "Manage Videos" tab switches both the form AND the list section ("All Releases" → "All Videos")
4. **Form Fields**: Title, Artist, YouTube URL, Description (NO display_order, NO published status)
5. **Edit Workflow**: Same as Releases - click video in "All Videos" list to populate form
6. **Delete Workflow**: Same as Releases - delete button with confirmation
7. **Sorting**: Videos displayed alphabetically by Artist, then Title (backend handles this)
8. **Validation**: YouTube URL format validation required
9. **Messaging**: Success/error feedback on create/update/delete
10. **No Publishing**: All videos in database are considered published (no filtering)

## Dependencies

### Existing Infrastructure (from S5.2)
- ✅ `backend/api/upsert-video.php` - Create/update videos
- ✅ `backend/api/delete-video.php` - Delete videos
- ✅ `backend/api/get-videos.php` - Retrieve all videos (sorted by artist, title)
- ✅ `frontend/src/services/videoService.ts` - VideoService with CRUD methods
- ✅ `frontend/src/types/Video.ts` - Video TypeScript types

### Existing Patterns to Follow
- ✅ `frontend/src/pages/AdminDashboard.tsx` - Release management UI patterns
- ✅ Material-UI form components and styling
- ✅ Release validation and error handling patterns

### New Dependencies
- Material-UI Tabs component (`@mui/material/Tabs`)
- Material-UI Tab component (`@mui/material/Tab`)

## Technical Architecture

### Component Structure
```
AdminDashboard
├── Tabs (NEW)
│   ├── Tab: "Manage Releases" (existing form)
│   └── Tab: "Manage Videos" (new form)
├── Release Form (existing - shown when tab 0)
├── Video Form (NEW - shown when tab 1)
├── All Releases List (existing - shown when tab 0)
└── All Videos List (NEW - shown when tab 1)
```

### State Management
```typescript
// Existing release state remains
const [releases, setReleases] = useState<Release[]>([]);
const [editingRelease, setEditingRelease] = useState<Release | null>(null);

// New video state (mirrors release pattern)
const [videos, setVideos] = useState<Video[]>([]);
const [editingVideo, setEditingVideo] = useState<Video | null>(null);

// New tab state
const [activeTab, setActiveTab] = useState(0); // 0 = Releases, 1 = Videos
```

### Form Fields

**Video Upsert Form** (mirrors Release form):
- Title (TextField, required)
- Artist (TextField, required)
- YouTube URL (TextField, required, URL validation)
- Description (TextField, multiline, optional)

**Validation Rules**:
- Title: Required, max 255 characters
- Artist: Required, max 255 characters
- YouTube URL: Required, must be valid URL format, YouTube domain preferred
- Description: Optional, max 2000 characters

## Implementation Increments

### Increment 1: Add Tabs Component to AdminDashboard
**Goal**: Add Material-UI Tabs to switch between Release and Video management

**Files Modified**:
- `frontend/src/pages/AdminDashboard.tsx`

**Changes**:
1. Import Tabs and Tab from @mui/material
2. Add `activeTab` state (0 = Releases, 1 = Videos)
3. Add Tabs component with "Manage Releases" and "Manage Videos" labels
4. Add `handleTabChange` handler
5. Wrap existing content in conditional rendering based on activeTab

**Acceptance Criteria**:
- [ ] Tabs appear at top of AdminDashboard
- [ ] Clicking "Manage Releases" shows existing release form/list
- [ ] Clicking "Manage Videos" shows placeholder for video section
- [ ] Tab selection persists while on page

---

### Increment 2: Create Video Upsert Form
**Goal**: Add video form fields mirroring release form structure

**Files Modified**:
- `frontend/src/pages/AdminDashboard.tsx`

**Changes**:
1. Add video state: `videos`, `editingVideo`, `videoFormData`
2. Create Video form section with:
   - Title TextField
   - Artist TextField
   - YouTube URL TextField
   - Description TextField (multiline)
   - "Create Video" / "Update Video" button at bottom
3. Add form handlers: `handleVideoInputChange`, `handleVideoSubmit`
4. Add form reset: `resetVideoForm`
5. Style form identically to Release form

**Acceptance Criteria**:
- [ ] Video form appears when "Manage Videos" tab is selected
- [ ] Form has all 4 fields: Title, Artist, YouTube URL, Description
- [ ] Form styling matches Release form
- [ ] Submit button label changes: "Create Video" vs "Update Video"
- [ ] Form fields are controlled components

---

### Increment 3: Add All Videos List
**Goal**: Create video list section for edit/delete actions

**Files Modified**:
- `frontend/src/pages/AdminDashboard.tsx`

**Changes**:
1. Add `loadVideos()` function using `services.videos.getVideos()`
2. Call `loadVideos()` in useEffect when component mounts
3. Create "All Videos" section (mirrors "All Releases"):
   - Typography heading: "All Videos"
   - Video list with edit/delete buttons
   - Display: Artist - Title (YouTube URL)
4. Add `handleEditVideo` to populate form
5. Add `handleDeleteVideo` with confirmation
6. Conditional rendering: Show "All Videos" only when activeTab === 1

**Acceptance Criteria**:
- [ ] "All Videos" section appears when "Manage Videos" tab is selected
- [ ] Videos display in alphabetical order (Artist, then Title)
- [ ] Each video shows: Artist - Title (YouTube URL)
- [ ] Edit button populates form with video data
- [ ] Delete button shows confirmation dialog

---

### Increment 4: Wire Up Video CRUD Operations
**Goal**: Connect form to backend API endpoints

**Files Modified**:
- `frontend/src/pages/AdminDashboard.tsx`

**Changes**:
1. Implement `handleVideoSubmit`:
   - Call `services.videos.upsertVideo()` with form data
   - Show success message
   - Reload video list
   - Reset form
2. Implement `handleDeleteVideo`:
   - Show confirmation dialog
   - Call `services.videos.deleteVideo(id)`
   - Show success message
   - Reload video list
3. Add YouTube URL validation:
   - Must be valid URL format
   - Warn if not YouTube domain (but allow)
4. Add error handling for all API calls
5. Add loading states during API operations

**Acceptance Criteria**:
- [ ] Creating new video calls upsertVideo API
- [ ] Updating existing video calls upsertVideo API with ID
- [ ] Success message appears after create/update
- [ ] Video list refreshes after create/update
- [ ] Delete confirmation dialog appears
- [ ] Deleting video calls deleteVideo API
- [ ] Success message appears after delete
- [ ] Video list refreshes after delete
- [ ] Error messages display for failed operations
- [ ] YouTube URL validation provides feedback

---

## Validation & Testing

### Manual Testing Checklist
- [ ] Tab Navigation
  - [ ] Click "Manage Releases" - shows release form and list
  - [ ] Click "Manage Videos" - shows video form and list
  - [ ] Tab selection persists during page interactions

- [ ] Create Video
  - [ ] Fill all required fields and submit
  - [ ] Verify success message
  - [ ] Verify video appears in "All Videos" list
  - [ ] Verify video appears on public Videos page
  - [ ] Verify form resets after successful create

- [ ] Edit Video
  - [ ] Click Edit on a video in list
  - [ ] Verify form populates with video data
  - [ ] Modify fields and submit
  - [ ] Verify success message
  - [ ] Verify changes reflected in list

- [ ] Delete Video
  - [ ] Click Delete on a video
  - [ ] Verify confirmation dialog appears
  - [ ] Confirm deletion
  - [ ] Verify success message
  - [ ] Verify video removed from list
  - [ ] Verify video removed from public Videos page

- [ ] Validation
  - [ ] Submit with empty Title - shows error
  - [ ] Submit with empty Artist - shows error
  - [ ] Submit with empty YouTube URL - shows error
  - [ ] Submit with invalid URL format - shows error
  - [ ] Submit with non-YouTube URL - shows warning but allows
  - [ ] Submit with max length exceeded - shows error

- [ ] Video List Display
  - [ ] Videos sorted alphabetically by Artist
  - [ ] Videos with same Artist sorted by Title
  - [ ] Video format: "Artist - Title (URL)"

### Edge Cases
- Empty video list (new database)
- YouTube URL variations (youtube.com, youtu.be, embed URLs)
- Special characters in Title/Artist/Description
- Very long YouTube URLs
- Concurrent editing (two admins editing same video)

### Integration Points
- [ ] Videos created in admin appear on public Videos page
- [ ] Videos deleted in admin disappear from public Videos page
- [ ] VideoDetail page works for newly created videos
- [ ] Related videos feature works with new videos

## Acceptance Criteria Coverage

1. ✅ Admin dashboard has "Manage Videos" tab
2. ✅ Clicking tab displays Video form and list
3. ✅ Form has: Title, Artist, YouTube URL, Description
4. ✅ Submit button: "Create Video" or "Update Video"
5. ✅ Clicking video in list loads it for editing
6. ✅ Delete button with confirmation
7. ✅ Success messages on create/update/delete
8. ✅ Error handling for API failures
9. ✅ YouTube URL validation
10. ✅ Videos alphabetically sorted (backend)
11. ✅ No published status (removed from requirements)

## Pattern Compliance

### Factory Pattern ✅
- Using `services.videos` from existing factory (S5.2)

### TypeScript Type Safety ✅
- Using `Video` interface from `types/Video.ts` (S5.2)
- Using `VideoFormData` interface from `services/videoService.ts` (S5.2)

### Component Architecture ✅
- Adding features to existing AdminDashboard component
- Following established patterns from Release management
- Using Material-UI components consistently

### Error Handling ✅
- Try/catch blocks for all API operations
- User-friendly error messages via snackbar
- Validation feedback for form fields

### API Integration ✅
- Using authenticated endpoints (upsert, delete)
- Proper error response handling
- Loading states during operations

## Documentation Updates

After implementation, update:
- [x] `docs/sprints/sprint_5_stories.md` - Mark S5.3 as COMPLETE
- [x] `docs/requirements/requirements-roadmap.md` - Update Sprint 5 progress to 100%
- [x] `README.md` - Update overall progress (31/43 stories = 72%)

## Deployment Notes

### Database
- No new migrations required (S5.2 already created videos table)

### Frontend Build
- No new dependencies required (Tabs/Tab already in @mui/material)

### Backend
- No changes required (S5.2 already created all endpoints)

## Risk Assessment

**LOW RISK** - This is a pure UI implementation that:
- Mirrors existing, working Release management patterns
- Uses existing, tested API endpoints from S5.2
- Uses existing, tested VideoService from S5.2
- No database changes required
- No new dependencies required

Potential Issues:
- Tab state management (mitigated by following MUI Tabs documentation)
- Form validation complexity (mitigated by reusing Release validation patterns)
- YouTube URL variations (mitigated by flexible validation)

## Success Criteria

S5.3 is complete when:
1. Admin can create videos using tabbed interface ✅
2. Admin can edit videos by clicking in list ✅
3. Admin can delete videos with confirmation ✅
4. Form validation prevents invalid submissions ✅
5. Success/error messages provide clear feedback ✅
6. Videos display alphabetically in list ✅
7. All manual tests pass ✅
8. Pattern compliance validated ✅
9. Documentation updated ✅

---

**Next Steps After S5.3**:
- Run `update-commit.md` workflow
- Mark Sprint 5 as 100% COMPLETE (3/3 stories)
- Begin Sprint 6: Discography System Implementation
