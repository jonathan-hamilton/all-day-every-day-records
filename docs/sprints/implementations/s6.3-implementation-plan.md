# S6.3 Implementation Plan: Admin Discography Management Controls

**Story**: Admin Discography Management Controls  
**Priority**: HIGH  
**Estimate**: 3-5 hours  
**Sprint**: Sprint 6

## Overview

Implement checkbox controls in the admin release form to manage release categorization for Releases and Discography sections. This enables administrators to control where releases appear on the public site.

## User Story

As an administrator, I want checkbox controls for categorizing releases so I can easily control whether releases appear in Releases, Discography, or both sections.

## Acceptance Criteria

- [x] Admin release form includes "Show in Releases" checkbox (checked by default)
- [x] Admin release form includes "Show in Discography" checkbox (unchecked by default)
- [x] Both checkboxes can be checked simultaneously for dual placement
- [x] Unchecking both checkboxes hides release from both sections (warning message displayed)
- [x] Checkboxes positioned below existing form fields, above submit button
- [x] POST endpoint `/upsert-release.php` accepts and saves categorization flags
- [x] Existing releases maintain their current categorization when edited
- [x] Admin can change categorization and see immediate effect on public pages
- [x] Success message confirms categorization changes

## Implementation Approach

### Incremental Implementation Plan

#### Increment 1: Update AdminDashboard State & Form UI
**Objective**: Add categorization checkboxes to the release form

**Tasks**:
1. Add `showInReleases` and `showInDiscography` to `releaseFormData` state (defaults: true, false)
2. Add Material-UI `Checkbox` and `FormControlLabel` imports
3. Create categorization section in form with two checkboxes
4. Position checkboxes below Description field, above submit button
5. Add validation warning when both checkboxes are unchecked

**Files Modified**:
- `frontend/src/pages/AdminDashboard.tsx`

**Acceptance Criteria**:
- Checkboxes render in correct position
- Default values set correctly (Releases: checked, Discography: unchecked)
- Both checkboxes can be toggled independently
- Warning message appears when both unchecked

#### Increment 2: Update Form Handlers & API Integration
**Objective**: Wire checkbox state to form submission and API calls

**Tasks**:
1. Update `handleReleaseInputChange` to handle checkbox changes
2. Update `handleEditRelease` to populate checkbox values from selected release
3. Update `handleReleaseSubmit` to include categorization flags in FormData
4. Update `handleResetReleaseForm` to reset checkboxes to defaults

**Files Modified**:
- `frontend/src/pages/AdminDashboard.tsx`

**Acceptance Criteria**:
- Checkbox changes update state correctly
- Editing a release populates checkbox values from database
- Form submission includes categorization flags
- Form reset restores default checkbox values

#### Increment 3: Update Backend API Endpoint
**Objective**: Extend upsert-release.php to handle categorization flags

**Tasks**:
1. Accept `show_in_releases` and `show_in_discography` POST parameters
2. Add validation for categorization flags (default to true/false if not provided)
3. Update INSERT statement to include categorization columns
4. Update UPDATE statement to include categorization columns
5. Ensure backward compatibility with requests missing categorization flags

**Files Modified**:
- `backend/api/upsert-release.php`

**Acceptance Criteria**:
- API accepts categorization parameters
- INSERT query includes categorization flags
- UPDATE query includes categorization flags
- Missing parameters default to show_in_releases=true, show_in_discography=false
- Existing releases maintain their categorization when edited

#### Increment 4: Update TypeScript Release Interface
**Objective**: Add categorization fields to Release type for admin responses

**Tasks**:
1. Add `showInReleases` and `showInDiscography` to `Release` interface
2. Verify type compatibility with API responses

**Files Modified**:
- `frontend/src/types/Release.ts`

**Acceptance Criteria**:
- TypeScript compilation succeeds
- No type errors in AdminDashboard.tsx
- Full type safety for categorization fields

#### Increment 5: Testing & Validation
**Objective**: Verify end-to-end functionality

**Tasks**:
1. Test creating new release with default categorization (Releases only)
2. Test creating release with Discography only
3. Test creating release with both sections checked
4. Test editing release and changing categorization
5. Test validation warning when both unchecked
6. Verify releases appear/disappear from Releases and Discography pages correctly
7. Test backward compatibility with existing releases

**Acceptance Criteria**:
- New releases default to Releases section only
- Dual categorization works correctly
- Categorization changes reflect immediately on public pages
- Warning message displays when appropriate
- No TypeScript or runtime errors
- Existing releases unaffected by update

## Technical Considerations

### State Management
- Add categorization flags to `releaseFormData` state object
- Default values: `showInReleases: true`, `showInDiscography: false`
- Update state handlers to manage checkbox changes

### Form Layout
```tsx
// Position in form:
// ... existing fields ...
// Description TextField

{/* Categorization Section */}
<Typography variant="subtitle1" sx={{ mt: 2, mb: 1 }}>
  Display Settings
</Typography>
<FormGroup>
  <FormControlLabel
    control={
      <Checkbox
        checked={releaseFormData.showInReleases}
        onChange={handleReleaseInputChange}
        name="showInReleases"
      />
    }
    label="Show in Releases"
  />
  <FormControlLabel
    control={
      <Checkbox
        checked={releaseFormData.showInDiscography}
        onChange={handleReleaseInputChange}
        name="showInDiscography"
      />
    }
    label="Show in Discography"
  />
</FormGroup>

{/* Warning when both unchecked */}
{!releaseFormData.showInReleases && !releaseFormData.showInDiscography && (
  <Alert severity="warning" sx={{ mt: 1 }}>
    This release will not appear on any public page.
  </Alert>
)}

// Submit button
```

### Backend API Update
```php
// In upsert-release.php
$show_in_releases = isset($_POST['show_in_releases']) ? 
    filter_var($_POST['show_in_releases'], FILTER_VALIDATE_BOOLEAN) : true;
$show_in_discography = isset($_POST['show_in_discography']) ? 
    filter_var($_POST['show_in_discography'], FILTER_VALIDATE_BOOLEAN) : false;

// INSERT statement
$sql = "INSERT INTO releases (..., show_in_releases, show_in_discography) 
        VALUES (..., ?, ?)";

// UPDATE statement  
$sql = "UPDATE releases SET ..., show_in_releases = ?, show_in_discography = ? 
        WHERE id = ?";
```

### TypeScript Interface
```typescript
// In Release.ts
export interface Release {
  // ... existing fields ...
  showInReleases: boolean;
  showInDiscography: boolean;
}
```

## Dependencies

### Required Before Starting
- S6.1 Database migration must be complete (columns exist)
- S6.1 API filtering must be functional
- S6.2 Discography page must be live for testing

### External Dependencies
- Material-UI Checkbox, FormControlLabel, FormGroup, Alert components
- Existing admin form patterns from AdminDashboard.tsx

## Risk Assessment

### Low Risk
- Checkbox UI implementation (standard Material-UI patterns)
- State management (follows existing form patterns)
- TypeScript interface updates (straightforward addition)

### Medium Risk
- Backend validation logic (need to handle edge cases)
- Backward compatibility (must not break existing releases)
- Warning message UX (clear but not intrusive)

### Mitigation Strategies
- Test with existing releases to ensure no data loss
- Default values ensure safe fallback behavior
- Comprehensive validation on both frontend and backend
- Clear user feedback for categorization changes

## Testing Strategy

### Manual Testing Checklist
1. **Create New Release**
   - Default: Show in Releases checked, Show in Discography unchecked
   - Verify release appears on Releases page only
   
2. **Dual Categorization**
   - Check both checkboxes
   - Verify release appears on both Releases and Discography pages
   
3. **Discography Only**
   - Uncheck Releases, check Discography
   - Verify release appears on Discography page only
   
4. **Warning Message**
   - Uncheck both checkboxes
   - Verify warning message displays
   - Attempt to submit (should prevent or warn)
   
5. **Edit Existing Release**
   - Edit release, change categorization
   - Verify changes persist after save
   - Verify immediate update on public pages
   
6. **Backward Compatibility**
   - Edit old release created before S6.3
   - Verify categorization preserves existing database values
   - Verify no data loss or unexpected behavior

### Edge Cases
- Release with no categorization in database (should default to Releases)
- Simultaneous edits by multiple admins (database integrity)
- Form reset behavior with unsaved changes
- Browser refresh with form data populated

## Success Criteria

### Functional Requirements Met
- ✅ Checkboxes functional and positioned correctly
- ✅ Default values match specifications
- ✅ Validation warning displays appropriately
- ✅ Backend accepts and stores categorization flags
- ✅ Existing releases unaffected by update

### User Experience Quality
- ✅ Intuitive checkbox labels and positioning
- ✅ Clear warning message when both unchecked
- ✅ Immediate visual feedback on checkbox changes
- ✅ Success message confirms categorization save

### Technical Quality
- ✅ No TypeScript compilation errors
- ✅ Type safety for all categorization fields
- ✅ Backward compatible with existing API consumers
- ✅ Database queries optimized and secure

## Completion Checklist

- [x] Increment 1: AdminDashboard UI updated with checkboxes
- [x] Increment 2: Form handlers and API integration complete
- [x] Increment 3: Backend API endpoint extended
- [x] Increment 4: TypeScript interfaces updated
- [x] Increment 5: Testing and validation complete
- [x] Documentation updated (sprint_6_stories.md, README.md)
- [x] Code committed with clear message
- [x] S6.3 marked as COMPLETE in sprint documentation

---

**Implementation Status**: COMPLETE ✅  
**Blocked By**: None (all dependencies complete)  
**Actual Completion**: Same session (3 hours)
