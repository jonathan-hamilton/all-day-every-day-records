# S4.1 Implementation Plan: Homepage Search Functionality

**Story**: S4.1 - Homepage Search Functionality  
**Status**: In Progress  
**Created**: December 13, 2025  
**Developer**: AI Assistant

---

## Story Overview

**User Story**:  
As a visitor, I want to search for releases from the homepage so I can quickly find specific music without navigating to the full releases page.

**Revised Acceptance Criteria** (per user clarification):
- [ ] Search input field placed **above** Recent Releases carousel
- [ ] Search filters **ALL releases** (not just recent)
- [ ] Search matches **artist name** and **release title** (case-insensitive, partial match)
- [ ] ~~Catalog number removed from codebase~~ (not used)
- [ ] Autocomplete dropdown appears below input with matching releases
- [ ] Dropdown format: `[50x50px Thumbnail] Artist - Title`
- [ ] Selecting a result navigates to Release Detail page
- [ ] Dropdown shows "No releases found" when no matches
- [ ] Dropdown closes when clicking outside
- [ ] Search debounced (300ms to match Releases page)
- [ ] Results list scrollable if exceeds best-practice limit
- [ ] Mobile responsive: search visible and functional on all breakpoints

---

## Architectural Directives

### Design Pattern Compliance

**✅ MANDATORY PATTERNS:**

1. **Factory Pattern - API Services**
   - Use `createServices()` for all API access
   - NO direct service imports or instantiation
   
2. **Component Architecture**
   - TypeScript interface for all props
   - Use React.FC type annotation
   - Named and default exports
   
3. **State Management**
   - `useState` for UI state (input value, dropdown open/close, results)
   - NO Zustand store (autocomplete is ephemeral UI state)
   
4. **API Integration**
   - Implement loading, success, error states
   - Type-safe API responses (ReleaseOverview[])
   
5. **Responsive Design**
   - Material-UI breakpoints (xs, sm, md)
   - Mobile-first approach

**Pattern Validation Checklist:**
- [ ] Factory pattern used for service creation
- [ ] Component has TypeScript props interface
- [ ] State management uses useState (no Zustand)
- [ ] API calls handle loading/error states
- [ ] Responsive design implemented with MUI sx props

---

## Technical Analysis

### Dependencies Review

**Existing Dependencies (✅ All Available):**
- Material-UI Autocomplete component (@mui/material 7.0.2)
- useDebounce custom hook (300ms - matches Releases page)
- createServices factory (API service pattern)
- ReleaseOverview type interface
- React Router (navigation to Release Detail)

**No New Dependencies Required** ✓

### API Integration

**Endpoint**: Use existing `GET /api/get-releases.php`

**Service Method**: `services.releases.getReleases({ status: 'published' })`

**Response Type**: `ReleaseOverview[]`

**Search Logic**: Client-side filtering on artist + title fields

### Catalog Number Removal

**Files to Update:**
1. `frontend/src/types/Release.ts` - Remove from 3 interfaces
2. `frontend/src/pages/ReleaseDetailPage.tsx` - Remove display logic
3. Documentation files (database-schema.md, sprint docs)

**Note**: Backend schema not modified (backward compatible)

---

## Implementation Increments

### Increment 1: Remove Catalog Number Field
**Estimate**: 30 minutes

**Tasks:**
1. Remove `catalog_number` from `Release` interface
2. Remove `catalog_number` from `ReleaseWithDetails` interface  
3. Remove `catalog_number` from `ReleaseOverview` interface
4. Remove catalog number display from `ReleaseDetailPage.tsx`

**Acceptance Criteria Met:**
- [x] Catalog number removed from codebase

**Design Patterns:**
- Type Safety (TypeScript)

**Testing:**
- Verify no TypeScript errors
- Verify ReleaseDetailPage still renders correctly

---

### Increment 2: Create ReleaseAutocomplete Component
**Estimate**: 3-4 hours

**Tasks:**
1. Create `frontend/src/components/ReleaseAutocomplete.tsx`
2. Implement TypeScript props interface
3. Add Material-UI Autocomplete with custom rendering
4. Implement debounced search (300ms using useDebounce hook)
5. Fetch all releases via `createServices().releases.getReleases()`
6. Client-side filtering on artist + title (case-insensitive, partial match)
7. Custom option rendering: 50x50px thumbnail + "Artist - Title"
8. Handle loading/error states
9. Scrollable results list (max height with overflow)
10. Close on outside click (Autocomplete built-in behavior)

**Component Interface:**
```typescript
interface ReleaseAutocompleteProps {
  onSelectRelease: (release: ReleaseOverview) => void;
  placeholder?: string;
}
```

**Acceptance Criteria Met:**
- [x] Search input with autocomplete dropdown
- [x] Debounced search (300ms)
- [x] Matches artist and title (partial, case-insensitive)
- [x] Dropdown format: [Thumbnail] Artist - Title
- [x] Scrollable results list
- [x] Close on outside click
- [x] "No releases found" message

**Design Patterns:**
- Factory Pattern (createServices)
- Component Architecture (TypeScript interface, React.FC)
- State Management (useState for input, results, loading)
- API Integration (loading/error states)

**Testing:**
- Verify dropdown appears on input
- Verify debounce works (300ms delay)
- Verify filtering matches artist OR title
- Verify thumbnail displays correctly
- Verify scrolling works with many results
- Verify "No releases found" appears

---

### Increment 3: Integrate Search on Homepage
**Estimate**: 1-2 hours

**Tasks:**
1. Update `frontend/src/pages/Home.tsx`
2. Import ReleaseAutocomplete component
3. Add search above "Recent Releases" section
4. Implement navigation to Release Detail on selection
5. Apply responsive styling (mobile/desktop)

**Integration Code:**
```typescript
<ReleaseAutocomplete
  onSelectRelease={(release) => navigate(`/releases/${release.slug}`)}
  placeholder="Search releases..."
/>
```

**Acceptance Criteria Met:**
- [x] Search placed above Recent Releases carousel
- [x] Selecting result navigates to Release Detail
- [x] Mobile responsive

**Design Patterns:**
- Responsive Design (MUI breakpoints)
- React Router navigation

**Testing:**
- Verify search appears above carousel
- Verify navigation works on selection
- Verify responsive layout on mobile/tablet/desktop

---

### Increment 4: Empty States & Polish
**Estimate**: 1 hour

**Tasks:**
1. Add loading spinner to autocomplete
2. Verify "No releases found" message styling
3. Add ARIA labels for accessibility
4. Test keyboard navigation (arrow keys, enter)
5. Verify focus management

**Acceptance Criteria Met:**
- [x] Loading indicator while fetching
- [x] Keyboard navigation support
- [x] Accessibility (ARIA attributes)

**Design Patterns:**
- Error Handling Pattern
- Accessibility standards

**Testing:**
- Verify loading spinner appears
- Verify keyboard navigation works
- Run accessibility audit

---

## Testing Strategy

### Unit Testing
- ReleaseAutocomplete component renders correctly
- Search filtering logic works (artist + title matching)
- Debounce delays API calls by 300ms

### Integration Testing
- Homepage displays search component
- Search results navigate to correct Release Detail page
- API integration returns expected data

### Manual Testing
- [ ] Search input visible on homepage
- [ ] Typing triggers debounced search
- [ ] Dropdown shows matching releases
- [ ] Thumbnail + Artist - Title format correct
- [ ] Selecting result navigates to Release Detail
- [ ] "No releases found" appears when no matches
- [ ] Dropdown closes on outside click
- [ ] Results scrollable when many matches
- [ ] Mobile responsive (test on phone/tablet)
- [ ] Keyboard navigation works
- [ ] Loading states display correctly

---

## Success Metrics

- Search returns results in <200ms (excluding API latency)
- Autocomplete component reusable for future features
- No TypeScript errors
- Passes accessibility audit (WCAG 2.1 AA)
- Mobile-friendly (tested on 320px width)

---

## Rollback Plan

If issues arise:
1. Remove ReleaseAutocomplete component
2. Remove search from Home.tsx
3. Revert catalog_number removal (restore from git)

---

## Notes

- Catalog number removal is cleanup work (field not actively used)
- Autocomplete component can be reused for Videos page in future
- Search fetches ALL releases (not paginated) - acceptable for current dataset size
- Client-side filtering preferred over new API endpoint (reduces backend complexity)

---

**Last Updated**: December 13, 2025
